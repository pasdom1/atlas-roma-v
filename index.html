<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Mappa Roma V - React</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <style>
    html, body {
      margin:0; padding:0;
      background:#000;
      height:100%;
      width:100%;
      overflow:hidden;
      touch-action:none;
    }
    #root {
      height:100vh;
      width:100vw;
      overflow:hidden;
    }
    img {
      will-change: transform;
      transform-origin: center center;
      object-fit: cover;
      width:100%;
      height:100%;
    }
  </style>
</head>
<body>

<div id="root"></div>

<!-- React CDN -->
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

<script>
const { useState, useRef } = React;

function App() {
  const imgRef = useRef(null);

  let scale = 1, lastScale = 1;
  let posX = 0, posY = 0, lastPosX = 0, lastPosY = 0;
  let startX = 0, startY = 0, startDistance = 0;
  let lastTap = 0;

  // Calcola distanza tra dita
  function dist(ev) {
    return Math.hypot(
      ev.touches[0].pageX - ev.touches[1].pageX,
      ev.touches[0].pageY - ev.touches[1].pageY
    );
  }

  function update() {
    imgRef.current.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`;
  }

  function handleStart(ev) {
    if (ev.touches.length === 2) {
      startDistance = dist(ev);
    } else {
      startX = ev.touches[0].pageX - lastPosX;
      startY = ev.touches[0].pageY - lastPosY;
    }
  }

  function handleMove(ev) {
    ev.preventDefault();

    if (ev.touches.length === 2) {
      const newDist = dist(ev);
      scale = Math.min(5, Math.max(1, lastScale * (newDist / startDistance)));
    }

    if (ev.touches.length === 1 && scale > 1) {
      posX = ev.touches[0].pageX - startX;
      posY = ev.touches[0].pageY - startY;
    }

    update();
  }

  function handleEnd(ev) {
    lastScale = scale;

    if (scale <= 1.02) {
      scale = 1;
      posX = posY = lastPosX = lastPosY = 0;
    } else {
      lastPosX = posX;
      lastPosY = posY;
    }

    update();

    const now = Date.now();
    if (now - lastTap < 300) {
      scale = scale > 1 ? 1 : 2;
      lastScale = scale;
      posX = posY = lastPosX = lastPosY = 0;
      update();
    }
    lastTap = now;
  }

  return React.createElement(
    "img",
    {
      ref: imgRef,
      src: "https://pasdom1.github.io/atlas-roma-v/assets/mappa.png",
      onTouchStart: handleStart,
      onTouchMove: handleMove,
      onTouchEnd: handleEnd
    }
  );
}

// Render App
ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
</script>

</body>
</html>
